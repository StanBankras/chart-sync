{"version":3,"sources":["../../server/modules/chartevents.js"],"names":["changeTicker","io","data","to","roomId","emit","room","rooms","oldIndex","activeTickers","indexOf","old","new","tickers","deleteTool","ticker","tool","filter","t","id","settings","p1","p2","movedItem","index","findIndex","addItem","date","Date","now","find"],"mappings":"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","sourcesContent":["import { rooms } from \"../server\";\nimport { saveRoom } from \"./db\";\n\n\nexport async function changeTicker(io, data) {\n  io.to(data.roomId).emit('change_ticker', data);\n\n  const room = rooms[data.roomId];\n  if(!room) return;\n\n  const oldIndex = room.activeTickers.indexOf(data.old);\n  room.activeTickers[oldIndex] = data.new;\n\n  if(!room.tickers[data.new]) room.tickers[data.new] = [];\n  \n  await saveRoom(data.roomId, room);\n}\n\nexport async function deleteTool(io, data) {\n  io.to(data.roomId).emit('del_item', data);\n\n  const room = rooms[data.roomId];\n  if(!room) return;\n\n  const ticker = data.ticker;\n  const tool = data.data;\n\n  room.tickers[ticker] = room.tickers[ticker].filter(t => t.id !== tool.id || !t.settings.p1 || !t.settings.p2);\n  \n  await saveRoom(data.roomId, room);\n}\n\nexport async function movedItem(io, data) {\n  const room = rooms[data.roomId];\n  if(!room) return;\n\n  const ticker = data.ticker;\n  const tool = data.data;\n\n  const index = room.tickers[data.ticker].findIndex(t => t.id === tool.id);\n  if(index === '-1' || index === -1) return;\n\n  room.tickers[data.ticker][index] = tool;\n  \n  await saveRoom(data.roomId, room);\n}\n\n\nexport async function addItem(io, data) {\n  io.to(data.roomId).emit('add_item', data);\n\n  const room = rooms[data.roomId];\n  if(!room) return;\n\n  const ticker = data.ticker;\n  const tool = data.data;\n  tool.date = Date.now();\n\n  if(room.tickers[ticker].find(t => t.id === tool.id)) return;\n  room.tickers[ticker] = [...room.tickers[ticker], tool];\n\n  await saveRoom(data.roomId, room);\n}"],"file":"chartevents.js"}